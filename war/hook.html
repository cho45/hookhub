<%
hook  = stash("hook");
title = String(hook.title())
%>
<%include= _header %>
<div id="hook" class="section">
	<h2>
		Web Hooks:
		<%= hook.title() %>
	</h2>

	<div class="section code">
		<h3>
			Code
		</h3>

		<div class="author">
			<a href="/<%= hook.user().nick() %>/">
				<img src="<%= hook.user().icon() %>" width="60" height="60" alt="<%= hook.user().nick() %>"/>
			</a>

			<% if (c.userIsAuthor()) { %>
			<form action="/<%= author %>/hook/<%= hook.key().getId() %>/edit">
				<input type="submit" value="Edit" class="button" />
			</form>
			<% } %>

			<% if (c.user()) { %>
			<form action="/my/hook/new">
				<input type="hidden" name="fork" value="<%= hook.id() %>"/>
				<input type="submit" value="Fork" class="button"/>
			</form>
			<% } %>

			<% if ((parent = hook.parent())) { %>
				<div class="fork">
					forked from
					<a href="/<%= parent.user().nick() %>/hook/<%= parent.id() %>">
						<img src="<%= parent.user().icon() %>" width="48" height="48" alt="<%= parent.user().nick() %>"/>
					</a>
				</div>
			<% } %>
		</div>

		<div class="code">
			<pre><code><%= hook.code() %></code></pre>
		</div>

		<div style="text-align: right">
			<script type="text/javascript"><!--
			google_ad_client = "pub-4629424540171624";
			/* 728x90, hookhub 09/07/07 */
			google_ad_slot = "5068464069";
			google_ad_width = 728;
			google_ad_height = 90;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
		</div>

		<div class="section" id="comments">
			<h4>Comments</h4>

			<% comments = stash('comments') %>
			<% for (var i = 0; i < comments.length(); i++) { var comment = comments.apply(i); if (!comment.user()) continue; %>
				<div class="comment">
					<div class="author">
						<a href="/<%= comment.user().nick() %>/">
							<img src="<%= comment.user().icon() %>" width="48" height="48" alt="<%= comment.user().nick() %>"/>
						</a>
					</div>
					<div class="body">
						<%= comment.body() %>
					</div>
				</div>
			<% } %>

			<% if (c.user()) { %>
			<form action="" method="post">
				<p><textarea name="body" cols="40" rows="5"></textarea></p>
				<p>
					<input type="hidden" name="mode" value="comment" />
					<input type="submit" value="Post" class="button" />
				</p>
			</form>
			<% } %>
		</div>
	</div>

	<div class="section" id="forked">
		<h3>Forked Web Hooks</h3>
		<% hooks = stash('childs') %>
		<% for (var i = 0; i < hooks.length(); i++) { var hook = hooks.apply(i) %>
		<% ret.push(cache(hook.key().toString(), function () { var ret = []; %>
			<%include= _hook %>
		<% return ret.join(''); })) %>
		<% } %>

		<div style="text-align: right">
			<script type="text/javascript"><!--
			google_ad_client = "pub-4629424540171624";
			/* 728x90, hookhub 09/07/07 */
			google_ad_slot = "5068464069";
			google_ad_width = 728;
			google_ad_height = 90;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
		</div>
	</div>

	<% if (c.userIsAuthor()) { %>
	<div class="section">
		<h3>Last result</h3>
		<pre><%= hook.result() %></pre>
	</div>

	<div class="section">
		<h3>Web Hooks URI <span class="less">(only you can see)</span></h3>
		<p>
			<input type="text" value="<%= c.absolute("/hook/" + hook.token()) %>" size="80" onclick="this.select()" onfocus="this.select()" class="text"/>
		</p>
	</div>
	<% } %>
	</div>
<%include= _footer %>
